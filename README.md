# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Kafka

–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Apache Kafka —Å Prometheus, Grafana –∏ Kafdrop –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **Apache Kafka** —Å —Ä–µ–∂–∏–º–æ–º KRaft (–±–µ–∑ Zookeeper)
- **Kafdrop** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–º Kafka
- **Prometheus** - —Å–±–æ—Ä –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
- **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –¥–∞—à–±–æ—Ä–¥—ã
- **Kafka Exporter** - —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ Kafka –¥–ª—è Prometheus
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- **CI/CD Pipeline** - GitHub Actions –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Python 3.13+ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- UV –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ (–¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/ZhikharevAl/kafka-monitoring.git
cd kafka-monitoring

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps
```

### 2. –î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º

| –°–µ—Ä–≤–∏—Å | URL | –õ–æ–≥–∏–Ω/–ü–∞—Ä–æ–ª—å |
|--------|-----|--------------|
| Kafdrop (Kafka UI) | <http://localhost:9001> | - |
| Grafana | <http://localhost:3000> | admin/admin |
| Prometheus | <http://localhost:9090> | - |

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Kafka –æ—Ç–≤–µ—á–∞–µ—Ç
kafka-topics --list --bootstrap-server localhost:9092

# –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–ø–∏–∫
kafka-topics --create --topic test --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞


## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **–õ–∞–≥ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π**: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è/–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º**: –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–ø–ø –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π**: –∞–∫—Ç–∏–≤–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∏ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –±—Ä–æ–∫–µ—Ä–∞**: –≤–µ—Ä—Å–∏–∏ API, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ª–æ–≥–æ–≤, –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã

### –î–∞—à–±–æ—Ä–¥—ã Grafana

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –≤–∫–ª—é—á–µ–Ω—ã –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è:

- –û–±–∑–æ—Ä Kafka
- –ì—Ä—É–ø–ø—ã –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
- –î–µ—Ç–∞–ª–∏ —Ç–æ–ø–∏–∫–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ –±—Ä–æ–∫–µ—Ä–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã Kafka

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# –°–ª–µ–¥—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–º —Å—Ü–µ–Ω–∞—Ä–∏—è–º –≤ docs/check-list.md
kafka-topics --create --topic test-topic --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
kafka-console-producer --topic test-topic --bootstrap-server localhost:9092

# –¢–µ—Å—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
kafka-console-consumer --topic test-topic --bootstrap-server localhost:9092 --from-beginning
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ –≤ [`docs/kafka-testing-guide.md`](docs/kafka-testing-guide.md):

1. **–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –±–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
4. **–ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–ø–ª–µ—Å–∫–æ–≤
5. **–ú—É–ª—å—Ç–∏-—Ç–æ–ø–∏–∫–∏** - —Å–∏–º—É–ª—è—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
6. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏—è–º–∏** - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
kafka-producer-perf-test --topic test-topic --num-records 10000 --record-size 1024 --throughput 1000 --producer-props bootstrap.servers=localhost:9092

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
kafka-consumer-perf-test --topic test-topic --bootstrap-server localhost:9092 --messages 10000 --threads 1
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ UV (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
curl -LsSf https://astral.sh/uv/install.sh | sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
uv sync --dev

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pre-commit —Ö—É–∫–æ–≤
uv run pre-commit install
```

### –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞:

- **Ruff** - –ª–∏–Ω—Ç–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Python
- **Pyright** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
- **Pre-commit hooks** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–∞–º–∏

```bash
# –ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–∏–Ω–≥–∞
uvx ruff check .

# –ó–∞–ø—É—Å–∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
uvx ruff format .

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
uv run pyright .
```

## CI/CD

GitHub Actions workflow (`.github/workflows/code-quality.yaml`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞ `uv.lock`
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç –ª–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é Ruff
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
4. –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ —Å –ø–æ–º–æ—â—å—é Pyright

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
.
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îú‚îÄ‚îÄ actions/          # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ GitHub Actions
‚îÇ   ‚îî‚îÄ‚îÄ workflows/        # CI/CD workflow'—ã
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ check-list.md     # –ë–∞–∑–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Kafka
‚îÇ   ‚îî‚îÄ‚îÄ kafka-testing-guide.md  # –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ prometheus/
‚îÇ   ‚îî‚îÄ‚îÄ prometheus.yml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
‚îú‚îÄ‚îÄ docker-compose.yaml   # –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ pyproject.toml       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Python –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ .pre-commit-config.yaml  # Pre-commit —Ö—É–∫–∏
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [`docs/check-list.md`](docs/check-list.md) - –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ Kafka
- [`docs/kafka-testing-guide.md`](docs/kafka-testing-guide.md) - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**Kafka –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
docker-compose logs kafka

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã
docker-compose restart kafka
```

**–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø–æ—Ä—Ç–æ–≤:**

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç—ã
lsof -i :9092
lsof -i :3000
lsof -i :9001
```

**–õ–∞–≥ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è:**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç: `kafka-consumer-groups --list --bootstrap-server localhost:9092`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–ø–ø—ã –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π: `kafka-consumer-groups --describe --group <group-name> --bootstrap-server localhost:9092`


## –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- [Apache Kafka](https://kafka.apache.org/) - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
- [Confluent](https://www.confluent.io/) - Docker –æ–±—Ä–∞–∑—ã Kafka
- [Prometheus](https://prometheus.io/) - —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [Grafana](https://grafana.com/) - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- [Kafdrop](https://github.com/obsidiandynamics/kafdrop) - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è Kafka
